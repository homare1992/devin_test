# 乳児活動記録分析・可視化Webアプリ - システムパターン

## アーキテクチャ概要

このプロジェクトは、クライアント-サーバーアーキテクチャを採用し、以下の3つの主要コンポーネントで構成されています：

1. **データ処理モジュール**：テキストデータの解析と分析を担当
2. **バックエンドサーバー**：APIエンドポイントを提供し、データ処理モジュールと連携
3. **フロントエンドアプリケーション**：ユーザーインターフェースとデータ可視化を担当

## 主要技術的決定

### データフロー

```
テキストファイル → パーサー → 構造化データ → 分析モジュール → 分析結果 → API → フロントエンド → 可視化
```

### モジュール分離

- データ処理と分析ロジックをバックエンドサーバーから分離
- フロントエンドとバックエンドの明確な責任分担
- 再利用可能なデータ処理コンポーネント

### データモデル

テキストデータから以下の構造化データモデルを生成：

1. **イベントデータ**：
   - 日付
   - 時間
   - イベント種別（睡眠、食事、排泄、体調など）
   - 関連値（量、持続時間など）
   - 備考

2. **日次サマリーデータ**：
   - 日付
   - 睡眠合計時間
   - ミルク合計量と回数
   - おしっこ・うんち合計回数
   - 体調不良イベント回数と種別

3. **成長データ**：
   - 日付
   - 体重
   - 身長
   - その他測定値

### API設計

RESTful APIアプローチを採用：

- `GET /api/health` - ヘルスチェック
- `POST /api/parse` - テキストデータの解析
- `GET /api/analyze` - データ分析の実行
- `POST /api/process` - 解析と分析の一括処理
- `GET /api/events` - すべてのイベントデータ取得
- `GET /api/summary/daily` - 日次サマリーデータ取得
- `GET /api/growth` - 成長データ取得
- `GET /api/analysis/vomit-correlation` - 吐き戻し相関分析結果取得
- `GET /api/analysis/sleep-patterns` - 睡眠パターン分析結果取得
- `GET /api/analysis/feeding-patterns` - 食事パターン分析結果取得
- `GET /api/analysis/comprehensive` - 総合分析結果取得

### フロントエンド構成

コンポーネントベースのアーキテクチャ：

- **ページコンポーネント**：
  - ダッシュボード
  - データアップロード
  - 睡眠分析
  - 食事分析
  - 吐き戻し分析
  - 成長分析
  - 404ページ

- **レイアウトコンポーネント**：
  - ヘッダー
  - サイドバー
  - フッター

- **共通コンポーネント**：
  - ローディングインジケーター
  - エラーメッセージ
  - ページセクション
  - データカード

- **チャートコンポーネント**：
  - 時系列チャート
  - 棒グラフ
  - ヒートマップ
  - 散布図

## 技術的パターン

### データ処理パターン

- **正規表現ベースのテキスト解析**：構造化されていないテキストから情報を抽出
- **パイプライン処理**：データの読み込み → 解析 → 変換 → 分析の流れ
- **キャッシング**：計算コストの高い分析結果のキャッシング

### バックエンドパターン

- **モジュラーAPI**：機能ごとに分離されたAPIエンドポイント
- **データ変換レイヤー**：内部データモデルとAPI応答の分離
- **エラーハンドリング**：一貫したエラー応答形式

### フロントエンドパターン

- **コンポーネント分離**：表示ロジックとデータ取得ロジックの分離
- **状態管理**：React Hooksを使用した状態管理
- **レスポンシブデザイン**：Material UIを使用した様々な画面サイズへの対応
- **データ可視化**：Rechartsライブラリを使用したインタラクティブなチャート
- **ルーティング**：React Router Domを使用したSPA内のページナビゲーション

### 実装パターン

- **非同期データ取得**：useEffectフックとaxiosを使用したAPIデータ取得
- **条件付きレンダリング**：ローディング状態やエラー状態に応じた表示切り替え
- **プロップドリリング回避**：コンポーネント階層を浅く保ち、必要に応じてコンテキストを使用
- **再利用可能なコンポーネント**：高い凝集性と低い結合性を持つコンポーネント設計
- **一貫したエラーハンドリング**：try-catchパターンとエラーコンポーネントの使用
